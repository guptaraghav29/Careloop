[
  {
    "reason": "Firebase configuration is required for real-time messaging and authentication",
    "description": "Firebase initialization module for Next.js App Router. Exports singleton Firebase app, database, and auth instances. Handles client-side Firebase SDK initialization with environment variables. Includes error handling for missing credentials and development/production mode detection.",
    "dependencies": [],
    "priority": 1,
    "filename": "firebase_config_TypeScript.prompt",
    "filepath": "lib/firebase.ts",
    "tags": [
      "config",
      "firebase",
      "backend"
    ],
    "context_urls": [
      {
        "url": "https://firebase.google.com/docs/web/setup",
        "purpose": "Firebase web SDK setup guide"
      },
      {
        "url": "https://firebase.google.com/docs/database/web/start",
        "purpose": "Firebase Realtime Database initialization"
      },
      {
        "url": "https://nextjs.org/docs/app/building-your-application/configuring/environment-variables",
        "purpose": "Next.js environment variables configuration"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "app",
            "signature": "export const app: FirebaseApp",
            "returns": "Firebase app instance"
          },
          {
            "name": "database",
            "signature": "export const database: Database",
            "returns": "Realtime Database instance"
          },
          {
            "name": "auth",
            "signature": "export const auth: Auth",
            "returns": "Firebase Auth instance"
          }
        ]
      }
    }
  },
  {
    "reason": "ElevenLabs service provides voice-to-text and text-to-speech capabilities for audio chat",
    "description": "ElevenLabs integration service using the JavaScript SDK. Provides streaming text-to-speech for AI responses and speech-to-text for user audio input. Handles microphone permissions, audio streaming, voice agent management, and error recovery. Implements HIPAA-compliant audio handling with no persistent storage.",
    "dependencies": [],
    "priority": 2,
    "filename": "elevenlabs_service_TypeScript.prompt",
    "filepath": "lib/elevenlabs.ts",
    "tags": [
      "service",
      "audio",
      "elevenlabs"
    ],
    "context_urls": [
      {
        "url": "https://github.com/elevenlabs/elevenlabs-js",
        "purpose": "ElevenLabs JavaScript SDK repository and examples"
      },
      {
        "url": "https://elevenlabs.io/docs/api-reference/streaming",
        "purpose": "ElevenLabs streaming API documentation"
      },
      {
        "url": "https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia",
        "purpose": "Browser microphone permissions and MediaStream API"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "startVoiceSession",
            "signature": "(voiceId: string): Promise<void>",
            "returns": "void",
            "errors": [
              "PermissionDeniedError",
              "APIError"
            ]
          },
          {
            "name": "stopVoiceSession",
            "signature": "(): void",
            "returns": "void"
          },
          {
            "name": "textToSpeech",
            "signature": "(text: string, voiceId: string): Promise<ArrayBuffer>",
            "returns": "Audio data"
          },
          {
            "name": "onTranscript",
            "signature": "(callback: (text: string) => void): void",
            "returns": "void"
          }
        ]
      }
    }
  },
  {
    "reason": "Zustand store manages chat state globally across components",
    "description": "Zustand state management store for chat functionality. Manages messages array, chat status, active participants, audio playback state, and error handling. Provides actions for sending messages, updating status, adding/removing participants, and managing audio state. Implements optimistic updates and rollback on error. TypeScript-first with strict typing.",
    "dependencies": [],
    "priority": 3,
    "filename": "chat_store_TypeScript.prompt",
    "filepath": "lib/stores/chatStore.ts",
    "tags": [
      "state",
      "zustand",
      "chat"
    ],
    "context_urls": [
      {
        "url": "https://github.com/pmndrs/zustand",
        "purpose": "Zustand state management library documentation"
      },
      {
        "url": "https://docs.pmnd.rs/zustand/guides/typescript",
        "purpose": "Zustand TypeScript patterns and best practices"
      },
      {
        "url": "https://docs.pmnd.rs/zustand/guides/updating-state",
        "purpose": "Zustand state update patterns"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "useChatStore",
            "signature": "(): ChatStore",
            "returns": "Chat store hook"
          },
          {
            "name": "sendMessage",
            "signature": "(content: string, participantId: string): void",
            "returns": "void"
          },
          {
            "name": "updateStatus",
            "signature": "(status: ChatStatus): void",
            "returns": "void"
          },
          {
            "name": "setAudioPlaying",
            "signature": "(isPlaying: boolean): void",
            "returns": "void"
          }
        ]
      }
    }
  },
  {
    "reason": "Message service handles Firebase Realtime Database operations for chat messages",
    "description": "Service layer for Firebase Realtime Database chat operations. Implements CRUD operations for messages with real-time listeners. Handles message persistence with proper indexing by timestamp and participant. Includes HIPAA-compliant encryption helpers, message status updates, and offline support. Provides hooks for React components to subscribe to real-time updates.",
    "dependencies": [
      "firebase_config_TypeScript.prompt"
    ],
    "priority": 4,
    "filename": "message_service_TypeScript.prompt",
    "filepath": "lib/services/messageService.ts",
    "tags": [
      "service",
      "firebase",
      "database"
    ],
    "context_urls": [
      {
        "url": "https://firebase.google.com/docs/database/web/read-and-write",
        "purpose": "Firebase Realtime Database read and write operations"
      },
      {
        "url": "https://firebase.google.com/docs/database/web/lists-of-data",
        "purpose": "Firebase data structure patterns for chat messages"
      },
      {
        "url": "https://firebase.google.com/docs/database/security",
        "purpose": "Firebase security rules for HIPAA compliance"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "sendMessage",
            "signature": "(userId: string, doctorId: string, content: string): Promise<string>",
            "returns": "Message ID",
            "errors": [
              "DatabaseError",
              "AuthError"
            ]
          },
          {
            "name": "subscribeToMessages",
            "signature": "(conversationId: string, callback: (messages: ChatMessage[]) => void): () => void",
            "returns": "Unsubscribe function"
          },
          {
            "name": "updateMessageStatus",
            "signature": "(messageId: string, status: MessageStatus): Promise<void>",
            "returns": "void"
          },
          {
            "name": "getConversationHistory",
            "signature": "(userId: string, doctorId: string, limit?: number): Promise<ChatMessage[]>",
            "returns": "Message array"
          }
        ]
      }
    }
  },
  {
    "reason": "Voice chat button component provides audio interface for doctor-patient communication",
    "description": "React client component for voice chat functionality. Renders a toggle button for voice input with visual indicators (microphone icon, recording pulse, speaking state). Integrates with ElevenLabs service for speech-to-text. Handles microphone permissions with user-friendly prompts. Displays real-time transcription and audio level indicators. Includes accessibility features (ARIA labels, keyboard navigation).",
    "dependencies": [
      "elevenlabs_service_TypeScript.prompt",
      "chat_store_TypeScript.prompt"
    ],
    "priority": 5,
    "filename": "voice_button_component_TypeScriptReact.prompt",
    "filepath": "src/components/VoiceButton.tsx",
    "tags": [
      "component",
      "ui",
      "audio"
    ],
    "context_urls": [
      {
        "url": "https://react.dev/reference/react/hooks",
        "purpose": "React 18 hooks documentation"
      },
      {
        "url": "https://react.dev/learn/typescript",
        "purpose": "React TypeScript patterns"
      },
      {
        "url": "https://www.w3.org/WAI/WCAG21/Understanding/audio-control.html",
        "purpose": "Accessibility guidelines for audio controls"
      }
    ],
    "interface": {
      "type": "component",
      "component": {
        "props": [
          {
            "name": "doctorId",
            "type": "string",
            "required": true
          },
          {
            "name": "voiceId",
            "type": "string",
            "required": false
          },
          {
            "name": "onTranscript",
            "type": "(text: string) => void",
            "required": false
          },
          {
            "name": "disabled",
            "type": "boolean",
            "required": false
          }
        ],
        "emits": [
          "transcriptReceived",
          "permissionDenied",
          "error"
        ]
      }
    }
  },
  {
    "reason": "Enhanced chat interface displays messages and integrates voice functionality",
    "description": "React client component that enhances the existing ChatInterface.tsx with voice capabilities. Displays conversation history with message bubbles (user on right, doctor on left). Integrates VoiceButton component for audio input. Shows typing indicators and audio playback status. Implements auto-scroll to latest message. Real-time message updates via Firebase listeners. Responsive design with Tailwind CSS using Coastal Aesthetic. Includes loading states and error boundaries.",
    "dependencies": [
      "voice_button_component_TypeScriptReact.prompt",
      "message_service_TypeScript.prompt",
      "chat_store_TypeScript.prompt"
    ],
    "priority": 6,
    "filename": "enhanced_chat_interface_TypeScriptReact.prompt",
    "filepath": "src/components/ChatInterface.tsx",
    "tags": [
      "component",
      "ui",
      "chat"
    ],
    "context_urls": [
      {
        "url": "https://react.dev/reference/react/useEffect",
        "purpose": "React useEffect for Firebase listeners"
      },
      {
        "url": "https://react.dev/reference/react/useRef",
        "purpose": "React useRef for auto-scroll implementation"
      },
      {
        "url": "https://tailwindcss.com/docs/responsive-design",
        "purpose": "Tailwind responsive design patterns"
      }
    ],
    "interface": {
      "type": "component",
      "component": {
        "props": [
          {
            "name": "userId",
            "type": "string",
            "required": true
          },
          {
            "name": "doctorId",
            "type": "string",
            "required": true
          },
          {
            "name": "doctorName",
            "type": "string",
            "required": false
          },
          {
            "name": "initialMessages",
            "type": "ChatMessage[]",
            "required": false
          }
        ],
        "emits": [
          "messageSent",
          "error"
        ]
      }
    }
  },
  {
    "reason": "Chat page provides the main route for doctor-patient messaging",
    "description": "Next.js App Router page component for /chat route. Server component that fetches initial conversation data and renders ChatInterface. Implements authentication check via middleware (redirects to login if not authenticated). Displays doctor information header with name and avatar. Includes back navigation to member portal. Handles error states (doctor not found, unauthorized access). Uses Suspense for streaming initial messages. Follows Next.js 16 App Router conventions with metadata export.",
    "dependencies": [
      "enhanced_chat_interface_TypeScriptReact.prompt"
    ],
    "priority": 7,
    "filename": "chat_page_TypeScriptReact.prompt",
    "filepath": "src/app/chat/page.tsx",
    "tags": [
      "page",
      "nextjs",
      "chat"
    ],
    "context_urls": [
      {
        "url": "https://nextjs.org/docs/app/building-your-application/routing/pages",
        "purpose": "Next.js App Router page conventions"
      },
      {
        "url": "https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations",
        "purpose": "Next.js server actions for data fetching"
      },
      {
        "url": "https://nextjs.org/docs/app/api-reference/file-conventions/metadata",
        "purpose": "Next.js metadata API for SEO"
      }
    ],
    "interface": {
      "type": "page",
      "page": {
        "route": "/chat",
        "params": [],
        "dataSources": [
          {
            "kind": "api",
            "source": "Firebase Realtime Database",
            "method": "GET",
            "description": "Fetch conversation history and doctor information",
            "auth": "Firebase Auth",
            "outputs": [
              "messages",
              "doctor"
            ]
          }
        ]
      }
    }
  },
  {
    "reason": "Index navigation update links the existing Member Portal to the new chat page",
    "description": "HTML modification to index.html that updates the 'Message your doctor' button to link to the new /chat route. Changes button from static to anchor tag or adds onclick handler for Next.js navigation. Preserves existing button styling (secondary button class, Coastal Aesthetic). Ensures smooth transition between static HTML page and Next.js app router. Includes data attributes for tracking and analytics.",
    "dependencies": [],
    "priority": 8,
    "filename": "index_nav_update_HTML.prompt",
    "filepath": "index.html",
    "tags": [
      "navigation",
      "html",
      "integration"
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "updateMessageButton",
            "signature": "HTML modification at line 524",
            "returns": "Updated button element"
          }
        ]
      }
    }
  }
]