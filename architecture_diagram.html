<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Add chat.html feature</title>
<script type="module">
import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({startOnLoad:true,theme:'default'});
window.addEventListener('load', () => {
    const moduleData = {"firebase_config_TypeScript": {"filename": "firebase_config_TypeScript.prompt", "priority": 1, "description": "Firebase initialization module for Next.js App Router. Exports singleton Firebase app, database, and auth instances. Handles client-side Firebase SDK initialization with environment variables. Includes error handling for missing credentials and development/production mode detection.", "dependencies": [], "tags": ["config", "firebase", "backend"], "filepath": "lib/firebase.ts"}, "elevenlabs_service_TypeScript": {"filename": "elevenlabs_service_TypeScript.prompt", "priority": 2, "description": "ElevenLabs integration service using the JavaScript SDK. Provides streaming text-to-speech for AI responses and speech-to-text for user audio input. Handles microphone permissions, audio streaming, voice agent management, and error recovery. Implements HIPAA-compliant audio handling with no persistent storage.", "dependencies": [], "tags": ["service", "audio", "elevenlabs"], "filepath": "lib/elevenlabs.ts"}, "chat_store_TypeScript": {"filename": "chat_store_TypeScript.prompt", "priority": 3, "description": "Zustand state management store for chat functionality. Manages messages array, chat status, active participants, audio playback state, and error handling. Provides actions for sending messages, updating status, adding/removing participants, and managing audio state. Implements optimistic updates and rollback on error. TypeScript-first with strict typing.", "dependencies": [], "tags": ["state", "zustand", "chat"], "filepath": "lib/stores/chatStore.ts"}, "message_service_TypeScript": {"filename": "message_service_TypeScript.prompt", "priority": 4, "description": "Service layer for Firebase Realtime Database chat operations. Implements CRUD operations for messages with real-time listeners. Handles message persistence with proper indexing by timestamp and participant. Includes HIPAA-compliant encryption helpers, message status updates, and offline support. Provides hooks for React components to subscribe to real-time updates.", "dependencies": ["firebase_config_TypeScript.prompt"], "tags": ["service", "firebase", "database"], "filepath": "lib/services/messageService.ts"}, "voice_button_component_TypeScriptReact": {"filename": "voice_button_component_TypeScriptReact.prompt", "priority": 5, "description": "React client component for voice chat functionality. Renders a toggle button for voice input with visual indicators (microphone icon, recording pulse, speaking state). Integrates with ElevenLabs service for speech-to-text. Handles microphone permissions with user-friendly prompts. Displays real-time transcription and audio level indicators. Includes accessibility features (ARIA labels, keyboard navigation).", "dependencies": ["elevenlabs_service_TypeScript.prompt", "chat_store_TypeScript.prompt"], "tags": ["component", "ui", "audio"], "filepath": "src/components/VoiceButton.tsx"}, "enhanced_chat_interface_TypeScriptReact": {"filename": "enhanced_chat_interface_TypeScriptReact.prompt", "priority": 6, "description": "React client component that enhances the existing ChatInterface.tsx with voice capabilities. Displays conversation history with message bubbles (user on right, doctor on left). Integrates VoiceButton component for audio input. Shows typing indicators and audio playback status. Implements auto-scroll to latest message. Real-time message updates via Firebase listeners. Responsive design with Tailwind CSS using Coastal Aesthetic. Includes loading states and error boundaries.", "dependencies": ["voice_button_component_TypeScriptReact.prompt", "message_service_TypeScript.prompt", "chat_store_TypeScript.prompt"], "tags": ["component", "ui", "chat"], "filepath": "src/components/ChatInterface.tsx"}, "chat_page_TypeScriptReact": {"filename": "chat_page_TypeScriptReact.prompt", "priority": 7, "description": "Next.js App Router page component for /chat route. Server component that fetches initial conversation data and renders ChatInterface. Implements authentication check via middleware (redirects to login if not authenticated). Displays doctor information header with name and avatar. Includes back navigation to member portal. Handles error states (doctor not found, unauthorized access). Uses Suspense for streaming initial messages. Follows Next.js 16 App Router conventions with metadata export.", "dependencies": ["enhanced_chat_interface_TypeScriptReact.prompt"], "tags": ["page", "nextjs", "chat"], "filepath": "src/app/chat/page.tsx"}, "index_nav_update_HTML": {"filename": "index_nav_update_HTML.prompt", "priority": 8, "description": "HTML modification to index.html that updates the 'Message your doctor' button to link to the new /chat route. Changes button from static to anchor tag or adds onclick handler for Next.js navigation. Preserves existing button styling (secondary button class, Coastal Aesthetic). Ensures smooth transition between static HTML page and Next.js app router. Includes data attributes for tracking and analytics.", "dependencies": [], "tags": ["navigation", "html", "integration"], "filepath": "index.html"}};
    
    // Add hover listeners to all nodes
    setTimeout(() => {
        const nodes = document.querySelectorAll('.node');
        nodes.forEach(node => {
            const text = node.querySelector('.nodeLabel');
            if (!text) return;
            
            const nodeText = text.textContent.trim();
            const moduleId = nodeText.split(' ')[0];
            const data = moduleData[moduleId];
            
            if (data) {
                node.style.cursor = 'pointer';
                
                node.addEventListener('mouseenter', (e) => {
                    showTooltip(e, data);
                });
                
                node.addEventListener('mouseleave', () => {
                    hideTooltip();
                });
            }
        });
    }, 500);
});
function showTooltip(e, data) {
    hideTooltip();
    
    const tooltip = document.createElement('div');
    tooltip.id = 'module-tooltip';
    tooltip.innerHTML = `
        <div style="font-weight:600;margin-bottom:8px;font-size:1.1em;">${data.filename}</div>
        <div style="margin-bottom:6px;"><strong>Priority:</strong> ${data.priority}</div>
        <div style="margin-bottom:6px;"><strong>Path:</strong> ${data.filepath}</div>
        <div style="margin-bottom:6px;"><strong>Tags:</strong> ${data.tags.join(', ')}</div>
        <div style="margin-bottom:6px;"><strong>Dependencies:</strong> ${data.dependencies.length > 0 ? data.dependencies.join(', ') : 'None'}</div>
        <div style="margin-top:8px;padding-top:8px;border-top:1px solid #ddd;font-size:0.9em;color:#444;">${data.description}</div>
    `;
    
    document.body.appendChild(tooltip);
    
    const rect = e.target.closest('.node').getBoundingClientRect();
    tooltip.style.left = rect.right + 10 + 'px';
    tooltip.style.top = rect.top + window.scrollY + 'px';
}
function hideTooltip() {
    const existing = document.getElementById('module-tooltip');
    if (existing) existing.remove();
}
</script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#fff;color:#000;padding:2rem;max-width:1400px;margin:0 auto}
h1{font-size:2rem;font-weight:600;margin-bottom:2rem;padding-bottom:1rem;border-bottom:2px solid #000}
.diagram{border:1px solid #000;padding:2rem;margin:2rem 0;overflow-x:auto;position:relative}
.mermaid{display:flex;justify-content:center}
#module-tooltip{
    position:absolute;
    background:#fff;
    border:2px solid #000;
    padding:1rem;
    max-width:400px;
    z-index:1000;
    box-shadow:4px 4px 0 rgba(0,0,0,0.1);
    font-size:0.9rem;
    line-height:1.5;
}
.node{transition:opacity 0.2s}
.node:hover{opacity:0.8}
</style></head><body>
<h1>Add chat.html feature</h1>
<div class="diagram"><pre class="mermaid">flowchart TB
        PRD["Add chat.html feature"]
    
    subgraph Frontend
        voice_button_component_TypeScriptReact["voice_button_component_TypeScriptReact (5)"]
        enhanced_chat_interface_TypeScriptReact["enhanced_chat_interface_TypeScriptReact (6)"]
        chat_page_TypeScriptReact["chat_page_TypeScriptReact (7)"]
    end
    
    subgraph Backend
        firebase_config_TypeScript["firebase_config_TypeScript (1)"]
        message_service_TypeScript["message_service_TypeScript (4)"]
    end
    
    subgraph Shared
        elevenlabs_service_TypeScript["elevenlabs_service_TypeScript (2)"]
        chat_store_TypeScript["chat_store_TypeScript (3)"]
        index_nav_update_HTML["index_nav_update_HTML (8)"]
    end
    
    PRD --> Frontend
    PRD --> Backend

    message_service_TypeScript -->|uses| firebase_config_TypeScript
    voice_button_component_TypeScriptReact -->|uses| elevenlabs_service_TypeScript
    voice_button_component_TypeScriptReact -->|uses| chat_store_TypeScript
    enhanced_chat_interface_TypeScriptReact -->|uses| voice_button_component_TypeScriptReact
    enhanced_chat_interface_TypeScriptReact -->|uses| message_service_TypeScript
    enhanced_chat_interface_TypeScriptReact -->|uses| chat_store_TypeScript
    chat_page_TypeScriptReact -->|uses| enhanced_chat_interface_TypeScriptReact
    
    classDef frontend fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef backend fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef shared fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    classDef system fill:#E0E0E0,stroke:#616161,stroke-width:3px
    
    class voice_button_component_TypeScriptReact,enhanced_chat_interface_TypeScriptReact,chat_page_TypeScriptReact frontend
    class firebase_config_TypeScript,message_service_TypeScript backend
    class elevenlabs_service_TypeScript,chat_store_TypeScript,index_nav_update_HTML shared
    class PRD system</pre></div>
</body></html>